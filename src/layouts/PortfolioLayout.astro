---
import Header from '../components/Header.astro';
import Sidebar from '../components/Sidebar.astro';
import '../styles/global.css';
interface Props { title: string; }
const { title } = Astro.props;
---
<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" /><link rel="icon" type="image/svg+xml" href="/favicon.svg" /><title>{title} | Bereket Designs</title><script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
  <div id="sidebar-overlay" class="sidebar-overlay"></div>
  <div class="page-wrapper"><Header /><Sidebar /><main class="main-content"><div class="container"><slot /></div></main></div>
  <script>
    // --- Mobile Menu Logic ---
    const toggleButton = document.getElementById('mobile-menu-toggle');
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebar-overlay');
    function closeMenu() { sidebar?.classList.remove('is-open'); overlay?.classList.remove('is-visible'); document.body.style.overflow = ''; }
    toggleButton?.addEventListener('click', () => { const isOpen = sidebar?.classList.toggle('is-open'); overlay?.classList.toggle('is-visible', isOpen); document.body.style.overflow = isOpen ? 'hidden' : ''; });
    overlay?.addEventListener('click', closeMenu);

    // --- Unified Theme Switcher Logic ---
    const themeToggles = document.querySelectorAll('.theme-toggle');
    
    // !!! THIS IS THE FIX !!!
    const applyTheme = (theme: string | null) => { document.documentElement.classList.toggle('dark', theme === 'dark'); };

    const savedTheme = localStorage.getItem('theme');
    if (savedTheme) { applyTheme(savedTheme); }
    else { const isSystemDark = window.matchMedia('(prefers-color-scheme: dark)').matches; applyTheme(isSystemDark ? 'dark' : 'light'); }
    
    themeToggles.forEach(toggle => {
      toggle.addEventListener('click', () => {
        const isDark = document.documentElement.classList.contains('dark');
        const newTheme = isDark ? 'light' : 'dark';
        applyTheme(newTheme);
        localStorage.setItem('theme', newTheme);
      });
    });
  </script>
</body>
</html>
<style is:global>
  .sidebar-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0,0,0,0.5); z-index: 150; opacity: 0; pointer-events: none; transition: opacity 0.3s ease; }
  .sidebar-overlay.is-visible { opacity: 1; pointer-events: auto; }
  .page-wrapper { display: grid; grid-template-columns: 1fr; }
  @media (min-width: 1024px) { .page-wrapper { grid-template-columns: 320px 1fr; } }
  .sidebar { display: none; }
  @media (min-width: 1024px) { .sidebar { display: flex; } }
  .main-content { padding-top: 0; }
  @media (min-width: 1024px) { .main-content { padding-top: 2rem; } }
</style>