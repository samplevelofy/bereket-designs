---
import PortfolioLayout from '../../layouts/PortfolioLayout.astro'; // Use the new layout
import { supabase } from '../../lib/supabase';
import type { Design } from '../../lib/types';

export const prerender = false;

const { id } = Astro.params;
let design: Design | null = null;
if (id) {
  const { data } = await supabase.from('designs').select('*').eq('id', id).single();
  design = data;
}
if (!design) { return new Response("Design not found", { status: 404 }); }
---
<PortfolioLayout title={design.title}>
  <article class="design-detail">
    <header class="design-header">
      <h1>{design.title}</h1>
      <div class="meta-info">
        <span><strong>Client:</strong> {design.client}</span>
        <span><strong>Project Type:</strong> {design.project_type}</span>
      </div>
    </header>
    
    <img src={design.cover_image} alt={design.title} class="hero-image" />
    
    <div class="design-content">
      <div class="main-body">
        <h2>Creative Brief</h2>
        <div class="brief-text">
          {design.creative_brief?.split('\n').map(p => p.trim() && <p>{p}</p>)}
        </div>
      </div>
      <aside class="detail-sidebar">
        <div class="sidebar-box">
          <h3>Tools Used</h3>
          <ul class="tools-list">
            {design.tools_used?.map(tool => <li>{tool}</li>)}
          </ul>
        </div>
      </aside>
    </div>
  </article>
</PortfolioLayout>
<style>
/* Styles are simplified to fit within the new layout */
.design-header h1 { font-size: 3.5rem; }
.meta-info { display: flex; gap: 2rem; color: var(--hint-color); }
.hero-image { width: 100%; border-radius: 24px; margin: 2rem 0; }
.design-content { display: grid; grid-template-columns: 1fr; gap: 3rem; }
@media(min-width: 900px) { .design-content { grid-template-columns: 2.5fr 1fr; } }
.brief-text p { margin-bottom: 1.5rem; }
h2 { font-size: 2rem; padding-bottom: 1rem; border-bottom: 1px solid var(--border-color); margin-bottom: 2rem; }
.sidebar-box { background: var(--secondary-bg-color); padding: 1.5rem; border-radius: 16px; position: sticky; top: 3rem; }
.tools-list { list-style: none; padding: 0; margin: 0; }
.tools-list li { background: var(--bg-color); padding: 0.5rem 1rem; border-radius: 8px; margin-bottom: 0.5rem; font-weight: 500; }
</style>