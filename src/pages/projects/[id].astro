---
import MainLayout from '../../layouts/MainLayout.astro';
import { supabase } from '../../lib/supabase';
import type { Project } from '../../lib/types';

const { id } = Astro.params;
let project: Project | null = null;
if (id) {
  const { data } = await supabase.from('projects').select('*').eq('id', id).single();
  project = data;
}
if (!project) { return new Response("Project not found", { status: 404 }); }
---
<MainLayout title={project.title}>
  <a href="/" class="back-link">&larr; Back to all projects</a>
  <article class="project-detail">
    <header class="project-header">
      <h1>{project.title}</h1>
      <p>{project.short_description}</p>
    </header>
    
    <img src={project.image} alt={project.title} class="main-image" />
    
    <div class="project-content">
      <div class="main-body">
        <h2>About this Project</h2>
        <div class="description-text">
          {project.description?.split('\n').map(p => <p>{p}</p>)}
        </div>
      </div>
      <aside class="sidebar">
        <div class="sidebar-box">
          <h3>Tech Stack</h3>
          <ul class="tech-list">
            {project.tech_stack?.map(tech => <li>{tech}</li>)}
          </ul>
        </div>
        <div class="sidebar-box">
          <h3>Links</h3>
          <a href={project.live_demo_url} class="btn" target="_blank">View Live Demo</a>
          <a href={project.github_repo_url} class="btn-secondary" target="_blank">View on GitHub</a>
        </div>
      </aside>
    </div>
  </article>
</MainLayout>
<style>
  .back-link { display: inline-block; margin-bottom: 2rem; font-weight: 500; }
  .project-header { text-align: center; padding: 2rem 0; }
  .project-header h1 { font-size: 3rem; }
  .project-header p { font-size: 1.25rem; color: var(--hint-color); max-width: 700px; margin: 0 auto; }
  .main-image { width: 100%; border-radius: 24px; margin-bottom: 3rem; }
  .project-content { display: grid; grid-template-columns: 1fr; gap: 3rem; }
  @media(min-width: 900px) {
    .project-content { grid-template-columns: 3fr 1fr; }
  }
  .description-text p { margin-bottom: 1.5rem; }
  .sidebar-box { background: var(--secondary-bg-color); padding: 1.5rem; border-radius: 16px; margin-bottom: 2rem; }
  .tech-list { list-style: none; padding: 0; margin: 0; }
  .tech-list li { background: var(--bg-color); padding: 0.5rem 1rem; border-radius: 8px; margin-bottom: 0.5rem; font-weight: 500; }
  .btn, .btn-secondary { display: block; width: 100%; text-align: center; padding: 0.75rem; border-radius: 12px; font-weight: 600; margin-bottom: 1rem; }
  .btn { background: var(--accent-color); color: #fff; }
  .btn-secondary { background: var(--border-color); color: var(--text-color); }
</style>